# Что это?
- мультиплеерная игра Cavetronic
- 2D-игра с видом сбоку про дронов, которые исследуют бесконечные пещеры, пытаясь выбраться на поверхность
- чтобы преодолевать большие расстояния под землей игроку придется бурить дыры в стенах
- чтобы бурить стены, понадобятся инструменты и электричество
- чтобы создавать инструменты, требуется перерабатывать определенные ресурсы
- чтобы создавать электричество, требуется сжигать определенные ресурсы
- добыче ресурсов препятствуют постоянно спавнящиеся противники и хрупкость мира
- геймплейный цикл состоит из следующих повторяющихся итераций
  1) разведки местности,
  2) добычи ресурсов
  3) доставки ресурсов в хабы
  4) переработки ресурсов в инструменты и электричество

## Геймплейные цели игры
- основная цель — добраться до двух точек интереса, расположенных на большом удалении от начальной точки возрождения игрока
- первая точка интереса — поверхность, там игрок узнает о ситуации, о которой 

## Референсы
- `terraria` — отсюда вид сбоку, пещеры, добыча руды и агрессивные противники с большим спавн рейтом
- `factorio` — отсюда система заводов, логистика ресурсов, автоматизация производства, автоматические дроны

## Особенности игры
- глубокая интеграция физической симуляции, а именно:
- почти все объекты в игре — физически корректные тела, которые реагируют на внешний мир
- добыча ресурсов — это в буквальном смысле откалывание кусков породы от стен
- транспортировка ресурсов предполагает наличие специального транспорта, который нужно "тянуть за собой"
- переработка ресурсов

## Архитектура софта
- Сервер-авторитарная модель
- структура логики - ECS (bitECS)
- сериализация данных — bitECS/serialize
- Физика - Rapier2D (WASM)
- рендер - Pixi.js (WebGL)
- реалтайм-транспорт — uWebSockets.js или webrtc, пока решение не принято

## Архитектура кода
- в основу положена ECS архитектура
- используется bitecs последней версии 0.4
- версия важна, потому что в 0.4 много breaking changes и новых подходов
- если не уверен по поводу актуальности собственных знаний — загляни в [bitecs.md](./bitecs.md) файл, там локальная копия доки
- за обработку всей логики отвечает серверная версия ecs-мира (далее LECS, Logic ECS)
- за отображение игры отвечает клиентская версия ecs-мира (далее VECS, Visual ECS)
- LECS сериализует ограниченное кол-во сущностей и компонентов и передаёт в VECS через сеть
- VECS должен сохранять работоспособность в браузере, так как может и будет использован для сингл-плеер режима игры и для разработки

## ECS компоненты
- компоненты должны содержать в себе наименьшее кол-во данных
- название компонента начинается с `c_`
- компоненты лежат в папке src/components
- компоненты разделены по типам: общие, сервер-онли и клиент-онли
- общие компоненты начинаются с `n_` (`n_c_position`)
- сервер-онли компоненты начинаются с `so_` (`so_c_activeHead`)
- клиент-онли компоненты начинаются с `co_` (`co_c_label`)
- компоненты хранят в себе только данные, которые bitecs может сериализовать(то есть типизированные списки и поставляемые из bitecs обертки над массивами)

## ECS системы
- системы должны содержать в себе наименьшее кол-во логики на единицу системы
- название системы начинается с `s_`
- системы, необходимые и в 
- системы разделены по типам: общие, сервер-онли и клиент-онли
- сервер-онли компоненты начинаются с `so_` (`so_c_activeHead`)
- клиент-онли компоненты начинаются с `co_` (`co_c_label`)

## Физика
- для просчёта физики в LECS поднимается rapier.js мир, который обновляется(world.step()) 120 раз в секунду
- для просчёта коллизий, рейкастов и геометрии в VECS поднимается rapier.js мир, который обновляется исключительно данными из сетевого транспорта, world.step() не вызывается
- VECS версия физики сглаживает сетевые обновления позиций объектов при помощи интерполяции

## Мультиплеер
- кол-во игроков — 2–4
- Сервер управляет симуляцией, клиенты получают состояние
- для сингл-плеер мода нетворк транспорт(S_SO_Transport) будет заменяться на локальный транспорт(S_CO_Transport), который почти напрямую будет передавать данные в VECS
- для дев-мода S_CO_Transport будет имитировать задержку и джиттеры для тестирования синхронизации клиента и сервера

## Мир
- Процедурная генерация мира
- Мир бесконечный в ширину и глубину, вверху имеется небольшой слой "поверхности"
- мир представляет собой бесконечные пещеры (тоннели)
- 


## Геймплей
- Ориентация на физическое взаимодействие с объектами
- Игрок управляет дроном
- Добыча ископаемых в пещерах

## Управление
- TBD

## Графика
- зелено-чёрная графика имитирующая старый терминал
- TBD

## Стек
- TypeScript
- Pixi.js 8
- @dimforge/rapier2d
- bitECS
- Webpack 5
